if (self.CavalryLogger) { CavalryLogger.start_js(["+EPvh"]); }

__d("MessengerContextualActions.react",["cx","ContextualLayerUpdateOnScroll","LayerHideOnBlur","Link.react","React","ReactAbstractContextualDialog","ReactLayer"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i;d=b("React").PropTypes;var j=b("ReactLayer").createClass(b("ReactAbstractContextualDialog").createSpec({displayName:"MessengerContextualActionsDialog",theme:{wrapperClassName:"_hw2",arrowDimensions:{offset:12,length:12}}}));h=babelHelpers.inherits(a,b("React").Component);h&&h.prototype;a.prototype.render=function(){var a=this.props,c=a.children;a=babelHelpers.objectWithoutProperties(a,["children"]);return b("React").createElement(j,babelHelpers["extends"]({alignment:"center",behaviors:{ContextualLayerUpdateOnScroll:b("ContextualLayerUpdateOnScroll"),LayerHideOnBlur:b("LayerHideOnBlur")}},a,{onToggle:this.props.onToggle}),b("React").createElement("ul",{className:"_hw3"},c))};function a(){h.apply(this,arguments)}a.propTypes={onToggle:d.func};a.Item=c;i=babelHelpers.inherits(c,b("React").Component);i&&i.prototype;c.prototype.render=function(){return b("React").createElement("li",{className:"_hw4"},b("React").createElement(b("Link.react"),{className:"_hw5",onClick:this.props.onClick},this.props.children))};function c(){i.apply(this,arguments)}c.propTypes={onClick:d.func};e.exports=a}),null);
__d("MessengerDeleteMessageDialogReact.bs",["fbt","bs_curry","ReasonReact.bs","MessengerDialogReact.bs","MessengerDialogBodyReact.bs"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("ReasonReact.bs").statelessComponent("MessengerDeleteMessageDialogReact");function i(){return g._("Delete Message")}var j=g._("Are you sure you want to delete this message?");function k(){return g._("Delete")}function l(a,c,d,e){var f=function(){b("bs_curry")._1(a,!1);return b("bs_curry")._1(c,0)};return[h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8],function(){return b("ReasonReact.bs").element(0,0,b("MessengerDialogReact.bs").Dialog[0](0,a,0,0,0,0,0,[b("ReasonReact.bs").element(0,0,b("MessengerDialogReact.bs").Header[0](0,0,i(0))),b("ReasonReact.bs").element(0,0,b("MessengerDialogBodyReact.bs").make(0,[j])),b("ReasonReact.bs").element(0,0,b("MessengerDialogReact.bs").Footer[0](0,0,[b("ReasonReact.bs").element(0,0,b("MessengerDialogReact.bs").CancelButton[0]([d],[])),b("ReasonReact.bs").element(0,0,b("MessengerDialogReact.bs").Button[0](0,[k(0)],0,["danger"],[f],[0],0,0,[]))]))]))},h[10],h[11],h[12],h[13]]}a=b("ReasonReact.bs").wrapReasonForJs(h,function(a){return l(a.onToggle,a.onDelete,a.onCancel,[])});f.component=h;f.renderDialogHeaderMsg=i;f.dialogBodyMsg=j;f.renderDialogButtonMsg=k;f.make=l;f.jsComponent=a}),null);
__d("ReasonBootloadOnRender.react",["LoadOnRender.react","React","promiseDone"],(function(a,b,c,d,e,f){__p&&__p();var g;c=babelHelpers.inherits(a,b("React").Component);g=c&&c.prototype;function a(){var a,c;for(var d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=g.constructor).call.apply(a,[this].concat(e)),this.$1=function(a){b("promiseDone")(this.props.loader.load(),a)}.bind(this),c}a.prototype.render=function(){"use strict";return b("React").createElement(b("LoadOnRender.react"),{placeholder:this.props.placeholder,loader:this.$1,component:this.props.component})};e.exports=a}),null);
__d("ReasonResource",["Promise","JSResourceReference","promiseDone"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g;g=babelHelpers.inherits(h,b("JSResourceReference"));g&&g.prototype;h.prototype.load=function(){return new(b("Promise"))(function(a){b("promiseDone")(this.getFullComponent(),function(b){a(b.jsComponent)})}.bind(this))};h.prototype.getFullComponent=function(){return this.__reference.load()};h.prototype.setResourceReference=function(a){this.__reference=a;return this};function h(){g.apply(this,arguments)}function a(a){return new h(a.getModuleId()).setResourceReference(a)}e.exports=a}),null);
__d("XMessengerDotComSaveController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/save/message/",{})}),null);
__d("MessengerMessageActions.react",["cx","fbt","CurrentUser","FBClipboardLink.react","ImmutableObject","MercuryConfig","JSResource","MessengerEnvironment","ReactLayeredComponentMixin_DEPRECATED","LazyComponent.react","MercuryAttachmentType","MercuryMessageActions","MercuryMessageInfo","MessengerDialogs.bs","MessengerContextualActions.react","MessengerDeleteMessageDialogReact.bs","MessengerReactionsMenu.react","StoryAttachmentStyle","React","ReasonBootloadOnRender.react","ReasonResource","AsyncRequest","CollectionsDisplaySurface","CollectionCurationMechanisms","MessengerConfig","MessengerDotComSaveModule","MessengerURIUtils.bs","SaveMessageUtils","SavedStateActions","URLMatcher","XMessengerDotComSaveController","gkx","idx"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i=b("MessengerDeleteMessageDialogReact.bs").jsComponent,j=b("MessengerContextualActions.react").Item;a=b("React").PropTypes;c=b("React").createClass({displayName:"MessengerMessageActions",mixins:[b("ReactLayeredComponentMixin_DEPRECATED")],propTypes:{hasFormatting:a.func,isActive:a.bool,isDeletable:a.bool,isFromViewer:a.bool,isShowingOriginal:a.bool,includeReactions:a.bool,message:a.instanceOf(b("ImmutableObject")).isRequired,onToggleOriginal:a.func,onShowMenu:a.func.isRequired,onReplyToMessage:a.func,isSavedView:a.bool},getDefaultProps:function(){return{isDeletable:!0}},getInitialState:function(){return{shown:!1}},render:function(){return this.props.isActive?b("React").createElement("span",{className:"_2rvp",ref:"actions",onClick:this._toggleShown},this.renderMenu()):null},renderMenu:function(){return!this.state.open?null:b("React").createElement(b("MessengerReactionsMenu.react"),{entryPoint:"dot_menu",message:this.props.message,onHide:this._hidePopover,refProp:function(){return this.refs.actions}.bind(this),useChatEmojiReact:b("MercuryConfig").MCER})},_openPopover:function(){this.setState({open:!0,shown:!1})},_hidePopover:function(){this.setState({open:!1})},renderLayers:function(){if(!this.state.shown)return{};var a=void 0;this.props.isSavedView?a=this._getSaveListItems():a=this._getThreadListItems();return{contextualDialog:b("React").createElement(b("MessengerContextualActions.react"),{context:this.refs.actions,onToggle:this._handleActionsToggle,shown:this.props.isActive},this._renderRetry(),a)}},_getThreadListItems:function(){__p&&__p();var a=[];b("MessengerConfig").canSaveMessages&&a.push(b("React").createElement(j,{key:"save-messenger",onClick:this._handleMessengerSave},this._renderSaveToMessengerItemMsg()));a.push(b("React").createElement(j,{key:"delete",onClick:this._handleDelete},this._renderActionItemMsg()));var c=this._getLinkToAttachment();c&&b("MessengerConfig").CopyAttachmentLink&&a.push(b("React").createElement(j,{key:"copy-link",onClick:this._handleLink},this._renderCopyAttachmentLinkMsg(c)));this.props.hasFormatting&&this.props.hasFormatting()&&this.props.onToggleOriginal&&a.push(b("React").createElement(j,{key:"view-source",onClick:this._handleToggleOriginal},this._renderShowOriginalMsg()));this._canSaveMessageToFacebook()&&!b("MessengerConfig").canSaveMessages&&a.push(b("React").createElement(j,{key:"save",onClick:this._handleFacebookSave},this._renderSaveItemMsg()));b("MessengerConfig").ShowMessageLinks&&a.push(b("React").createElement(j,{key:"react",onClick:this._handleLink},this._renderLinkItemMsg()));this.props.includeReactions&&a.push(b("React").createElement(j,{key:"perma-link",onClick:this._openPopover},this._renderReactionMsg()));!b("MessengerEnvironment").messengerui&&this.props.onReplyToMessage&&this.props.message.body&&b("gkx")("AT4XqrVNBYwaTCldftX_3p63LEbGgIcHGQ5WMySWbZYMlZu22QdH6RZZJZsVQ4mH1XIJ58rjz4PZkNOr6zG9IRwyYOaUiyj2qvuh3U3wbMhrUA")&&a.push(b("React").createElement(j,{key:"reply-to-message",onClick:this._handleReplyToMessage},this._renderReplyToMessage()));return a},_getSaveListItems:function(){var a=[];a.push(b("React").createElement(j,{key:"unsave-messenger",onClick:this._handleMessengerUnsave},this._renderUnsaveToMessengerItemMsg()));return a},_toggleShown:function(a){a.stopPropagation(),this.setState({shown:!this.state.shown},function(){return this.props.onShowMenu(this.state.shown)}.bind(this))},_renderActionItemMsg:function(){return h._("Delete")},_renderSaveToMessengerItemMsg:function(){return h._("Save")},_renderUnsaveToMessengerItemMsg:function(){return h._("Unsave")},_renderSaveItemMsg:function(){return b("CurrentUser").isWorkUser()?h._("Save to Workplace"):this._isMarketplaceAttachment()?h._("Save to Marketplace"):h._("Save to Facebook")},_renderReactionMsg:function(){return h._("React")},_renderReplyToMessage:function(){return h._("Reply")},_renderShowOriginalMsg:function(){if(this.props.isShowingOriginal)return h._("Show Formatted");else return h._("Show Original")},_renderCopyAttachmentLinkMsg:function(a){var c=h._("Copy Link To Share");return b("React").createElement(b("FBClipboardLink.react"),{suppress:!0,tooltip:c,value:a},c)},_renderLinkItemMsg:function(){var a=b("MessengerURIUtils.bs").getURIForMessage(this.props.message).getQualifiedURIBase().toString(),c=h._("Copy Link");return b("React").createElement(b("FBClipboardLink.react"),{suppress:!0,tooltip:"",value:a},c)},_renderRetry:function(){return!b("MercuryMessageInfo").hasError(this.props.message)?null:b("React").createElement(j,{onClick:this._handleRetry},h._("Try Again"))},_handleActionsToggle:function(a){a||this._handleDeselect()},_handleDeselect:function(){this.setState({shown:!1},function(){return this.props.onShowMenu(this.state.shown)}.bind(this))},_handleDelete:function(){var a=this.props.message;b("MessengerDialogs.bs").showDialog(function(){return b("React").createElement(i,{onDelete:function(){b("MercuryMessageActions").get()["delete"](a.thread_id,[a.message_id])},onToggle:this._handleDialogToggle,onCancel:this._handleDeselect,isFromViewer:this.props.isFromViewer})}.bind(this))},_getLinkToAttachment:function(){var a=this.props.message;return(a=a)!=null?(a=a.attachments)!=null?(a=a[0])!=null?(a=a.share)!=null?a.uri:a:a:a:a},_isMarketplaceAttachment:function(){var a=this.props.message;if(!b("MessengerDotComSaveModule").enabled_messenger_save)return!1;a=(a=a)!=null?(a=a.attachments)!=null?(a=a[0])!=null?(a=a.share)!=null?a.style_list:a:a:a:a;if(a)for(var c=0;c<a.length;c++)if(a[c]===b("StoryAttachmentStyle").GROUP_SELL_PRODUCT_ITEM)return!0;return!1},_canSaveMessageToFacebook:function(){__p&&__p();var a=this.props.message;if(b("MessengerDotComSaveModule").enabled_messenger_save&&this._isSavableMessageAttachment())return!0;if(b("MessengerDotComSaveModule").enabled_messenger_save&&a.attachments&&a.attachments.length>0&&a.attachments[0].share&&a.attachments[0].share.media&&a.attachments[0].share.media.playable)return!0;if(b("MessengerDotComSaveModule").enabled_messenger_save){a=b("URLMatcher").match(a.body);if(a!=null&&a.length>0)return!0}return!1},_handleLink:function(){this._handleActionsToggle(!1)},_isSavableMessageAttachment:function(){__p&&__p();var a=this.props.message.attachments;if(!a||a.length===0)return!1;for(var c=0;c<a.length;c++){var d=a[c];!1;if(d.share&&d.share.style_list){var e=d.share.style_list;e=b("SaveMessageUtils").isSavableMessageAttachment(e)}else e=d.attach_type===b("MercuryAttachmentType").VIDEO;if(!e)return!1}return!0},_handleFacebookSave:function(){var a=this.props.message,c=b("CollectionsDisplaySurface").MESSENGER_DOT_COM_MESSAGE,d=b("CollectionCurationMechanisms").RIGHT_CLICK;new(b("AsyncRequest"))().setURI(b("XMessengerDotComSaveController").getURIBuilder().getURI()).setData({action:b("SavedStateActions").SAVE,surface:c,mechanism:d,message_id:a.message_id}).send();b("MessengerDialogs.bs").showDialog(function(){return b("React").createElement(b("ReasonBootloadOnRender.react"),{loader:b("ReasonResource")(b("JSResource")("MessengerSaveMessageDialogReact.bs").__setRef("MessengerMessageActions.react")),placeholder:b("React").createElement("div",null),component:b("React").createElement(b("LazyComponent.react"),{onToggle:this._handleDialogToggle,isMarketplaceAttachment:this._isMarketplaceAttachment()})})}.bind(this));this._handleActionsToggle(!1)},_handleMessengerSave:function(){var a=this.props.message,c=b("CollectionsDisplaySurface").MESSENGER_DOT_COM_MESSAGE,d=b("CollectionCurationMechanisms").RIGHT_CLICK;new(b("AsyncRequest"))().setURI(b("XMessengerDotComSaveController").getURIBuilder().getURI()).setData({action:b("SavedStateActions").SAVE,surface:c,mechanism:d,message_id:a.message_id}).setHandler(this._showMessengerSaveConfirmationDialog).send();this._handleActionsToggle(!1)},_showMessengerSaveConfirmationDialog:function(a){b("MessengerDialogs.bs").showDialog(function(){return b("React").createElement(b("ReasonBootloadOnRender.react"),{loader:b("ReasonResource")(b("JSResource")("MessengerSaveMessageDialogReact.bs").__setRef("MessengerMessageActions.react")),placeholder:b("React").createElement("div",null),component:b("React").createElement(b("LazyComponent.react"),{onToggle:this._handleDialogToggle})})}.bind(this))},_handleMessengerUnsave:function(){this._handleActionsToggle(!1)},_handleDialogToggle:function(a){a||b("MessengerDialogs.bs").removeDialog()},_handleRetry:function(){this._handleDeselect(),b("MercuryMessageActions").get().resend(this.props.message)},_handleToggleOriginal:function(){this.props.onToggleOriginal&&this.props.onToggleOriginal(),this._handleActionsToggle(!1)},_handleReplyToMessage:function(){this.props.onReplyToMessage&&this.props.onReplyToMessage(this.props.message),this._handleActionsToggle(!1)}});e.exports=c}),null);